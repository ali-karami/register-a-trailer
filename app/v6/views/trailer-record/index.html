{% extends "layout-v6.html" %}

{% block page_title %} Trailer record {% endblock %}

{% block after_header %}
    {% include "includes/phase-banner/standard-noback.html" %}
{% endblock %}





{% block content %}
    <main id="content" class="trailer-record" role="main">
        <div class="grid-row">
            <div class="column-full">
                <span class="heading-section">
                    <span class="heading">
                        <h1 class="heading-large">
                            <span class="caption large">Name</span>
                            Trailer record
                        </h1>
                    </span>
                    <span class="change">
                        <span><a href="/trailer-record/change-details"><strong>Change<span id="record-type"> company</span> details</strong></a></span>
                    </span>

                    <div class="clear"></div>
                </span>

                <p id="no-trailers">You have not registered any trailers.</p>

                <div class="form-group">
                    <button class="button">Register trailers</button>
                </div>

                <div id="trailer-bar"></div>

                <span id="trailer-table">
                </span>
            </div>
        </div>
    </main>
{% endblock %}





{% block body_end %}
    <script type="text/javascript" src="/public/v6/javascripts/sortable-table.js"></script>

    <script type="text/javascript">
        try {
            $('.heading-large span').html(member.user.name).css('text-transform', 'capitalize');
        } catch(err){
            $('.caption.large').hide();
        }

        delete member.currentTrailer;
        delete member.currentTrailerPosition;

        getRegisteredTrailers();

        // Create trailer record table
        try {
            if (registeredTrailers === 0) {
                $('#trailer-bar').hide();
            } else {
                $('#no-trailers').hide();

                var trailerRow = '<h2 class="heading-medium">' + registeredTrailers + ' trailer<span class="plural"></span></h2>\
                <table id="sortable-table">\
                        <thead>\
                        <tr>\
                            <th scope="col" onclick="sortTable(0)" id="reg" class="sort-default">Registration number</th>\
                            <th scope="col" onclick="sortTable(1)" id="vin" class="sort-default">VIN/Chassis number</th>\
                            <th scope="col" onclick="sortTable(2)" id="manu" class="sort-default">Manufacturer</th>\
                            <th scope="col">&nbsp;</th>\
                        </tr>\
                    </thead>\
                <tbody>';
                for (i = 0; i < member.trailers.length; i++) {
                    if (member.trailers[i].registered == true) {
                        trailerRow += '<tr>';
                        trailerRow += '<td scope="row">' + member.trailers[i].reg + '</td>';
                        if (!member.trailers[i].vin) {
                        } else {
                            trailerRow += '<td scope="row">' + member.trailers[i].vin + '</td>';
                        }
                        if (!member.trailers[i].chassis) {
                        } else {
                            trailerRow += '<td scope="row">' + member.trailers[i].chassis + '</td>';
                        }
                        trailerRow += '<td scope="row">' + member.trailers[i].manufacturer + '</td>';
                        trailerRow += '<td scope="row" id="manage"><a href="#" class="manage" data="' + i + '">Manage</a></td>';
                        trailerRow += '</tr>';
                    }
                }

                $('#trailer-table').html(trailerRow + '</tbody></table>');
            }
        } catch(err){}

        $('td a.manage').click(function(e) {
            e.preventDefault();
            var trailer = $(this).attr('data');
            member.currentTrailerPosition = trailer;
            go('/trailer-record/manage');
        });

        $('th#reg').click(function () {
            if ($(this).hasClass('sort-default')) {
                $(this).removeClass('sort-default').addClass('sort-a-z');
            } else if ($(this).hasClass('sort-a-z')) {
                $(this).removeClass('sort-a-z').addClass('sort-z-a');
            } else {
                $(this).removeClass('sort-z-a').addClass('sort-default');
            }
            $('th#vin').removeClass().addClass('sort-default');
            $('th#manu').removeClass().addClass('sort-default');
        });
        $('th#vin').click(function () {
            if ($(this).hasClass('sort-default')) {
                $(this).removeClass('sort-default').addClass('sort-a-z');
            } else if ($(this).hasClass('sort-a-z')) {
                $(this).removeClass('sort-a-z').addClass('sort-z-a');
            } else {
                $(this).removeClass('sort-z-a').addClass('sort-default');
            }
            $('th#reg').removeClass().addClass('sort-default');
            $('th#manu').removeClass().addClass('sort-default');
        });
        $('th#manu').click(function () {
            if ($(this).hasClass('sort-default')) {
                $(this).removeClass('sort-default').addClass('sort-a-z');
            } else if ($(this).hasClass('sort-a-z')) {
                $(this).removeClass('sort-a-z').addClass('sort-z-a');
            } else {
                $(this).removeClass('sort-z-a').addClass('sort-default');
            }
            $('th#reg').removeClass().addClass('sort-default');
            $('th#vin').removeClass().addClass('sort-default');
        });

        $('.button').click(next);

        function next() {
            go('/register/declaration');
        }
    </script>
{% endblock %}